
```{r}
library(readxl)
library(tidyverse)
```

##Elecciones GOBIERNO REGIONAL 2014

Carga data: 

```{r}
data14=read_xlsx("Tabla10-ERM2014-Regional.xlsx")
head(data14)
```

###Organizaciones políticas

```{r}
organizaciones14 = data14[c(5,6)]
organizaciones14 = organizaciones14[!duplicated(organizaciones14),]
```

Eliminar votos blancos y nulos:

```{r}
organizaciones14 = organizaciones14[-c(1,4),]
```

Total organizaciones a nivel regional:

```{r}
nrow(organizaciones14)
```

Por tipo:

```{r}
table(organizaciones14$TIPOORGPOL)
```

Partidos:

```{r}
names(table(organizaciones14[organizaciones14$TIPOORGPOL=="PARTIDO POLITICO",]$TXORGPOL))
```

###ORDENAR DATA:

Votos emitidos por distritos:

```{r}
emitidos = data14 %>% group_by(TXUBIGEO) %>% 
           summarise(votos_emitidos = sum(VOTOS, na.rm = T)) 
```

Votos blancos + nulos

```{r}
blancos_nulos = data14 %>% filter(TIPOORGPOL == "VOTOS EN BLANCO" | TIPOORGPOL =="VOTOS NULOS" ) %>%
                group_by(TXUBIGEO) %>% 
                summarise(blancos_nulos = sum(VOTOS, na.rm = T)) 

data_final14 = left_join(emitidos, blancos_nulos, by="TXUBIGEO") #join
```

votos partidos politicos:

```{r}
partidos_politicos = data14 %>% filter(TIPOORGPOL == "PARTIDO POLITICO") %>%
                group_by(TXUBIGEO) %>% 
                summarise(partidos_politicos = sum(VOTOS, na.rm = T)) 

data_final14 = left_join(data_final14, partidos_politicos, by="TXUBIGEO") #join
```

votos movimientos regionales:

```{r}
mov_regionales = data14 %>% filter(TIPOORGPOL == "MOVIMIENTO REGIONAL") %>%
                group_by(TXUBIGEO) %>% 
                summarise(mov_regionales = sum(VOTOS, na.rm = T)) 

data_final14 = left_join(data_final14, mov_regionales, by="TXUBIGEO") #join
```

Votos válidos y porcentaje partidos/movimientos

```{r}
data_final14  = data_final14 %>% 
          mutate (votos_validos = votos_emitidos-blancos_nulos,
                  por_partidos_politicos = partidos_politicos/votos_validos,
                  por_mov_regionales = mov_regionales/votos_validos) 
```

Concentración:

- P1: Proporción de votos válidos obtenidos por el partido más votado.
- P2: Proporción de votos válidos obtenidos por el segundo par- tido más votado.

C= P1 + P2

Eliminar votos blancos y nulos:

```{r}
data14= data14[!data14$TIPOORGPOL == "VOTOS EN BLANCO",]
data14= data14[!data14$TIPOORGPOL == "VOTOS NULOS",]
```

Ordenar tabla en según votos

```{r}
data14 <- data14[order(data14$TXUBIGEO, -data14$VOTOS),] 
```

Votos ganador
```{r}
primero = data14 %>% group_by(TXUBIGEO) %>% filter(row_number()==1) %>% mutate(primero=VOTOS)

data_final14 = left_join(data_final14, primero[c(1,13)], by="TXUBIGEO") #join 
```

Votos segundo
```{r}
segundo = data14 %>% group_by(TXUBIGEO) %>% filter(row_number()==2) %>% mutate(segundo=VOTOS)

data_final14 = left_join(data_final14, segundo[c(1,13)], by="TXUBIGEO") #join 
```

Calculo concentración:

```{r}
data_final14 = data_final14 %>% mutate(concentracion = primero/votos_validos + segundo/votos_validos)
```

```{r}
head(data_final14)
```



