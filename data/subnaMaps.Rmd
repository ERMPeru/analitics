<style>

table, td, th {
  border: none;
  padding-left: 1em;
  padding-right: 1em;
  min-width: 50%;
  margin-left: auto;
  margin-right: auto;
  margin-top: 1em;
  margin-bottom: 1em;
}

</style>


<a href="https://escience.washington.edu/research-project/opening-data-peru/">
<img src="https://github.com/ERMPeru/elecciones2018/raw/master/headerLogo.png" width="1000"></a>


# **MAPAS DE ELECCIONES SUBNACIONALES**

#### **José Manuel Magallanes Ph.D.**
<a href="https://rawgit.com/projectsUW/peru2016elections/master/Credits.html" target="_blank">CRÉDITOS y CONDICIONES DE USO</a>

```{r}
#suppressPackageStartupMessages()
library(dplyr)
library(maptools)  
library(rgeos)
library(rgdal)
library(sf)
library(reshape2)
library(ggplot2) 
library(tmap)
library(maps)
library(plotrix)
library(scales)
```

```{r}
load("data_final.Rda")
data_final=as.data.frame(data_final)
```

```{r}
id=read.csv("ID MAPAS.csv",stringsAsFactors = F)
str(id)
```


```{r}
id$TXUBIGEO=ifelse(nchar(id$TXUBIGEO)==5, paste0(0,id$TXUBIGEO),id$TXUBIGEO)
```


```{r}
data=left_join(id[c(4:5)], data_final)
```



```{r}
plgs=rgdal::readOGR("DISTRITO_16_03_2015.shp")
pts=rgdal::readOGR("points2018.shp")
peruframe=rgdal::readOGR("borderPeru.shp")
limaframe=rgdal::readOGR("justLima.shp")

```


```{r}
plgs  <- merge(plgs, data, by="ID") 
```
```{r}
pts = merge(pts, data, by="ID") 
```

```{r}

ptslistas=pts[,grep("^lis",names(plgs),
                value=TRUE)]
```

```{r}
names(ptslistas)
```
```{r}
summary(ptslistas$listasGL14)
summary(ptslistas$listasGL10)
summary(ptslistas$listasGL06)
summary(ptslistas$listasGL02)
```


```{r}
much02=ptslistas[!is.na(ptslistas$listasGL02) & ptslistas$listasGL02 >= 11,]
much06=ptslistas[!is.na(ptslistas$listasGL06) & ptslistas$listasGL06 >= 11,]
much10=ptslistas[!is.na(ptslistas$listasGL10) & ptslistas$listasGL10 >= 11,]
much14=ptslistas[!is.na(ptslistas$listasGL14) & ptslistas$listasGL14 >= 11,]
```

```{r}
muchp02=ptslistas[!is.na(ptslistas$listasGP02) & ptslistas$listasGP02 >= 11,]
muchp06=ptslistas[!is.na(ptslistas$listasGP06) & ptslistas$listasGP06 >= 11,]
muchp10=ptslistas[!is.na(ptslistas$listasGP10) & ptslistas$listasGP10 >= 11,]
muchp14=ptslistas[!is.na(ptslistas$listasGP14) & ptslistas$listasGP14 >= 11,]
```


```{r}
muchr02=ptslistas[!is.na(ptslistas$listasGR02) & ptslistas$listasGR02 >= 11,]
muchr06=ptslistas[!is.na(ptslistas$listasGR06) & ptslistas$listasGR06 >= 11,]
muchr10=ptslistas[!is.na(ptslistas$listasGR10) & ptslistas$listasGR10 >= 11,]
muchr14=ptslistas[!is.na(ptslistas$listasGR14) & ptslistas$listasGR14 >= 11,]
```


```{r}

plgsher=plgs[,grep("^Herf",
                names(plgs),
                value=TRUE)]
```

```{r}
names(plgsher)
```
```{r}

```

```{r}
her02R_top =plgsher[!is.na(plgsher$HerfindahlGR02) & plgsher$HerfindahlGR02 >= 0.35,]

her02R_bottom =plgsher[!is.na(plgsher$HerfindahlGR02) & plgsher$HerfindahlGR02 <= 0.15,]

her06R_top =plgsher[!is.na(plgsher$HerfindahlGR06) & plgsher$HerfindahlGR06 >= 0.35,]

her06R_bottom =plgsher[!is.na(plgsher$HerfindahlGR06) & plgsher$HerfindahlGR06 <= 0.15,]

her10R_top =plgsher[!is.na(plgsher$HerfindahlGR10) & plgsher$HerfindahlGR10 >= 0.35,]

her10R_bottom =plgsher[!is.na(plgsher$HerfindahlGR10) & plgsher$HerfindahlGR10 <= 0.15,]

her14R_top =plgsher[!is.na(plgsher$HerfindahlGR14) & plgsher$HerfindahlGR14 >= 0.35,]

her14R_bottom =plgsher[!is.na(plgsher$HerfindahlGR14) & plgsher$HerfindahlGR14 <= 0.15,]

```



```{r}
her02P_top =plgsher[!is.na(plgsher$HerfindahlGP02) & plgsher$HerfindahlGP02 >= 0.35,]

her02P_bottom =plgsher[!is.na(plgsher$HerfindahlGP02) & plgsher$HerfindahlGP02 <= 0.15,]

her06P_top =plgsher[!is.na(plgsher$HerfindahlGP06) & plgsher$HerfindahlGP06 >= 0.35,]

her06P_bottom =plgsher[!is.na(plgsher$HerfindahlGP06) & plgsher$HerfindahlGP06 <= 0.15,]

her10P_top =plgsher[!is.na(plgsher$HerfindahlGP10) & plgsher$HerfindahlGP10 >= 0.35,]

her10P_bottom =plgsher[!is.na(plgsher$HerfindahlGP10) & plgsher$HerfindahlGP10 <= 0.15,]

her14P_top =plgsher[!is.na(plgsher$HerfindahlGP14) & plgsher$HerfindahlGP14 >= 0.35,]

her14P_bottom =plgsher[!is.na(plgsher$HerfindahlGP14) & plgsher$HerfindahlGP14 <= 0.15,]

```




```{r}
her02_top =plgsher[!is.na(plgsher$HerfindahlGL02) & plgsher$HerfindahlGL02 >= 0.35,]

her02_bottom =plgsher[!is.na(plgsher$HerfindahlGL02) & plgsher$HerfindahlGL02 <= 0.15,]

her06_top =plgsher[!is.na(plgsher$HerfindahlGL06) & plgsher$HerfindahlGL06 >= 0.35,]

her06_bottom =plgsher[!is.na(plgsher$HerfindahlGL06) & plgsher$HerfindahlGL06 <= 0.15,]

her10_top =plgsher[!is.na(plgsher$HerfindahlGL10) & plgsher$HerfindahlGL10 >= 0.35,]

her10_bottom =plgsher[!is.na(plgsher$HerfindahlGL10) & plgsher$HerfindahlGL10 <= 0.15,]

her14_top =plgsher[!is.na(plgsher$HerfindahlGL14) & plgsher$HerfindahlGL14 >= 0.35,]

her14_bottom =plgsher[!is.na(plgsher$HerfindahlGL14) & plgsher$HerfindahlGL14 <= 0.15,]

```



```{r distritosPeru,echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=10,fig.height=8, fig.align='center'}
#quartz()
c1u=-79
c2u=-1.1

c1d=-71
c2d=-7.5

c1i=-81.5
c2i=-9.4


library(maps)
par(mfrow=c(2,2),mar=c(1, 1, 1, 1))
plot(peruframe, main="Elecciones Distritales 2002")
plot(her02_top,col='seagreen1',lty=0,add = TRUE)
plot(her02_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(much02,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)

text(c1u,c2u,paste0(nrow(much02)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")

text(c1d,c2d,paste0("Sin competencia en \n",length(her02_top)," Distritos"),cex = 1,col = 'darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her02_bottom)," Distritos"),col='red')
map.scale(ratio=FALSE, relwidth=0.3,metric=T,cex=0.5)

#####
plot(peruframe, main="Elecciones Distritales 2006")
plot(her06_top,col='seagreen1',lty=0,add = TRUE)
plot(her06_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(much06,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(much06)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her06_top)," Distritos"),cex = 1,col='darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her06_bottom)," Distritos"),col='red')

####
plot(peruframe, main="Elecciones Distritales 2010")
plot(her10_top,col='seagreen1',lty=0,add = TRUE)
plot(her10_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(much10,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(much10)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her10_top)," Distritos"),cex = 1,col='darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her10_bottom)," Distritos"),col='red')

####
plot(peruframe, main="Elecciones Distritales 2014")
plot(her14_top,col='seagreen1',lty=0,add = TRUE)
plot(her14_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(much14,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(much14)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her14_top)," Distritos"),cex = 1,col='darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her14_bottom)," Distritos"),col='red')
library(GISTools)
north.arrow(xb=-77, yb=-18, len=0.5, lab="N",col='grey')
detach("package:GISTools", unload=TRUE)

```



```{r provincias,echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=10,fig.height=8, fig.align='center'}
#quartz()
c1u=-79
c2u=-1.1

c1d=-71
c2d=-7.5

c1i=-81.5
c2i=-9.4


par(mfrow=c(2,2),mar=c(1, 1, 1, 1))
plot(peruframe, main="Elecciones Provinciales 2002")
plot(her02P_top,col='seagreen1',lty=0,add = TRUE)
plot(her02P_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(muchp02,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(muchp02)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her02P_top)," Distritos"),cex = 1,col = 'darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her02P_bottom)," Distritos"),col='red')
map.scale(ratio=FALSE, relwidth=0.3,metric=T,cex=0.5)

plot(peruframe, main="Elecciones Provinciales 2006")
plot(her06P_top,col='seagreen1',lty=0,add = TRUE)
plot(her06P_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(muchp10,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(muchp10)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her06P_top)," Distritos"),cex = 1,col='darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her06P_bottom)," Distritos"),col='red')


plot(peruframe, main="Elecciones Provinciales 2010")
plot(her10P_top,col='seagreen1',lty=0,add = TRUE)
plot(her10P_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(muchp10,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(muchp10)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her10P_top)," Distritos"),cex = 1,col='darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her10P_bottom)," Distritos"),col='red')


plot(peruframe, main="Elecciones Provinciales 2014")
plot(her14P_top,col='seagreen1',lty=0,add = TRUE)
plot(her14P_bottom,col='palevioletred1',lty=0,add = TRUE)
plot(muchp14,pch=16, col=alpha("blue",0.6),cex=0.5,add=TRUE)
text(c1u,c2u,paste0(nrow(muchp14)," Distritos con más\n de 10 candidatos"),cex = 0.8,col = "blue")
text(c1d,c2d,paste0("Sin competencia en \n",length(her14P_top)," Distritos"),cex = 1,col='darkgreen')
text(c1i,c2i,paste0("Alta competencia en \n",length(her14P_bottom)," Distritos"),col='red')
library(GISTools)
north.arrow(xb=-77, yb=-18, len=0.5, lab="N",col='grey')
detach("package:GISTools", unload=TRUE)

```


```{r regiones,echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=10,fig.height=8, fig.align='center'}
#quartz()
c1u=-79
c2u=-1.1

c1d=-71
c2d=-7.5

c1i=-81.5
c2i=-9.4


par(mfrow=c(2,2),mar=c(1, 1, 1, 1))
plot(peruframe, main="Elecciones Regionales 2002")
plot(her02R_top,col='seagreen1',lty=0,add = TRUE)
plot(her02R_bottom,col='palevioletred1',lty=0,add = TRUE)
text(c1d,c2d,paste0("Sin competencia en \n",length(her02R_top)," Distritos"),cex = 1,col = 'seagreen1')
text(c1i,c2i,paste0("Alta competencia en \n",length(her02R_bottom)," Distritos"),col='palevioletred1')
map.scale(ratio=FALSE, relwidth=0.3,metric=T,cex=0.5)

plot(peruframe, main="Elecciones Regionales 2006")
plot(her06R_top,col='seagreen1',lty=0,add = TRUE)
plot(her06R_bottom,col='palevioletred1',lty=0,add = TRUE)
text(c1d,c2d,paste0("Sin competencia en \n",length(her06R_top)," Distritos"),cex = 1,col='seagreen1')
text(c1i,c2i,paste0("Alta competencia en \n",length(her06R_bottom)," Distritos"),col='palevioletred1')


plot(peruframe, main="Elecciones Regionales 2010")
plot(her10R_top,col='seagreen1',lty=0,add = TRUE)
plot(her10R_bottom,col='palevioletred1',lty=0,add = TRUE)
text(c1d,c2d,paste0("Sin competencia en \n",length(her10R_top)," Distritos"),cex = 1,col='seagreen1')
text(c1i,c2i,paste0("Alta competencia en \n",length(her10R_bottom)," Distritos"),col='palevioletred1')


plot(peruframe, main="Elecciones Regionales 2014")
plot(her14R_top,col='seagreen1',lty=0,add = TRUE)
plot(her14R_bottom,col='palevioletred1',lty=0,add = TRUE)
text(c1d,c2d,paste0("Sin competencia en \n",length(her14R_top)," Distritos"),cex = 1,col='seagreen1')
text(c1i,c2i,paste0("Alta competencia en \n",length(her14R_bottom)," Distritos"),col='palevioletred1')
library(GISTools)
north.arrow(xb=-77, yb=-18, len=0.5, lab="N",col='grey')
detach("package:GISTools", unload=TRUE)

```