
```{r}
library(readxl)
library(tidyverse)
```

##### GOBIERNO REGIONAL 2014

Carga data: 

```{r}
dataGR14=read_xlsx("Tabla10-ERM2014-Regional.xlsx")
head(dataGR14)
```

###Organizaciones políticas

```{r}
organizacionesGR14 = dataGR14[c(5,6)]
organizacionesGR14 = organizacionesGR14[!duplicated(organizacionesGR14),]
```

Eliminar votos blancos y nulos:

```{r}
organizacionesGR14 = organizacionesGR14[-c(1,4),]
```

Total organizaciones a nivel regional:

```{r}
nrow(organizacionesGR14)
```

Por tipo:

```{r}
table(organizacionesGR14$TIPOORGPOL)
```

Partidos:

```{r}
names(table(organizacionesGR14[organizacionesGR14$TIPOORGPOL=="PARTIDO POLITICO",]$TXORGPOL))
```

###ORDENAR DATA:

Electores por distritos:

```{r}
electores = dataGR14 %>% 
            group_by(TXUBIGEO) %>% #seleccionar una fila por distrito
           summarise(electoresGR14 = max(ELECTORES, na.rm = T)) 
```

Votos emitidos por distritos:

```{r}
emitidos = dataGR14 %>% group_by(TXUBIGEO) %>% 
           summarise(emitidosGR14 = sum(VOTOS, na.rm = T))

data_finalGR14 = left_join(electores, emitidos, by="TXUBIGEO") #join

#ciudar que los que tienen 0 en votos emitidos sean NA
data_finalGR14[data_finalGR14$emitidosGR14==0,]$emitidosGR14 = NA
```

Calcular ausentes: 

```{r}
data_finalGR14 = data_finalGR14 %>% 
  mutate(ausentesGR14= electoresGR14 - emitidosGR14, 
         por_ausentesGR14 = (ausentesGR14/electoresGR14)*100)
```

Votos blancos + nulos

```{r}
blancos_nulos = dataGR14 %>% filter(TIPOORGPOL == "VOTOS EN BLANCO" | TIPOORGPOL =="VOTOS NULOS" ) %>%
                group_by(TXUBIGEO) %>% 
                summarise(blancosnulosGR14 = sum(VOTOS, na.rm = T)) 

data_finalGR14 = left_join(data_finalGR14, blancos_nulos, by="TXUBIGEO") #join

data_finalGR14  = data_finalGR14 %>% 
          mutate (por_blancosnulosGR14 = (blancosnulosGR14/emitidosGR14)*100) 
```

votos validos:

```{r}
data_finalGR14  = data_finalGR14 %>% 
          mutate (validosGR14 = emitidosGR14-blancosnulosGR14) 
```

votos partidos politicos:

```{r}
partidos_politicos = dataGR14 %>% filter(TIPOORGPOL == "PARTIDO POLITICO") %>%
                group_by(TXUBIGEO) %>% 
                summarise(partidosGR14 = sum(VOTOS, na.rm = T)) 

data_finalGR14 = left_join(data_finalGR14, partidos_politicos, by="TXUBIGEO") #join
```

votos movimientos regionales:

```{r}
mov_regionales = dataGR14 %>% filter(TIPOORGPOL == "MOVIMIENTO REGIONAL") %>%
                group_by(TXUBIGEO) %>% 
                summarise(movimientosGR14 = sum(VOTOS, na.rm = T)) 

data_finalGR14 = left_join(data_finalGR14, mov_regionales, by="TXUBIGEO") #join
```

porcentaje partidos/movimientos

```{r}
data_finalGR14  = data_finalGR14 %>% 
          mutate (por_partidosGR14 = (partidosGR14/validosGR14)*100,
                  por_movimientosGR14 = (movimientosGR14/validosGR14)*100) 
```

Concentración:

- P1: Proporción de votos válidos obtenidos por el partido más votado.
- P2: Proporción de votos válidos obtenidos por el segundo par- tido más votado.

C= P1 + P2

Eliminar votos blancos y nulos:

```{r}
dataGR14= dataGR14[!dataGR14$TIPOORGPOL == "VOTOS EN BLANCO",]
dataGR14= dataGR14[!dataGR14$TIPOORGPOL == "VOTOS NULOS",]
```

Ordenar tabla en según votos

```{r}
dataGR14 <- dataGR14[order(dataGR14$TXUBIGEO, -dataGR14$VOTOS),] 
```

Votos ganador
```{r}
primero = dataGR14 %>% group_by(TXUBIGEO) %>% filter(row_number()==1) %>% mutate(primeroGR14=VOTOS)

data_finalGR14 = left_join(data_finalGR14, primero[c(1,13)], by="TXUBIGEO") #join 
```

Votos segundo
```{r}
segundo = dataGR14 %>% group_by(TXUBIGEO) %>% filter(row_number()==2) %>% mutate(segundoGR14=VOTOS)

data_finalGR14 = left_join(data_finalGR14, segundo[c(1,13)], by="TXUBIGEO") #join 
```

Calculo concentración:

```{r}
data_finalGR14 = data_finalGR14 %>% mutate(concentracionGR14 = primeroGR14/validosGR14 + segundoGR14/validosGR14)
```

```{r}
head(data_finalGR14)
```

##### GOBIERNO PROVINCIAL 2014

Carga data: 

```{r}
dataGP14=read_xlsx("PROVINCIAL_2014_DISTRITAL.xlsx")
head(dataGP14)
```

###ORDENAR DATA:

Electores por distritos:

```{r}
electores = dataGP14 %>% 
            group_by(TXUBIGEO) %>% #seleccionar una fila por distrito
           summarise(electoresGP14 = max(ELECTORES, na.rm = T)) 
```

Votos emitidos por distritos:

```{r}
emitidos = dataGP14 %>% group_by(TXUBIGEO) %>% 
           summarise(emitidosGP14 = sum(VOTOS, na.rm = T))

data_finalGP14 = left_join(electores, emitidos, by="TXUBIGEO") #join

#ciudar que los que tienen 0 en votos emitidos sean NA
data_finalGP14[data_finalGP14$emitidosGP14==0,]$emitidosGP14 = NA
```

Calcular ausentes: 

```{r}
data_finalGP14 = data_finalGP14 %>% 
  mutate(ausentesGP14= electoresGP14 - emitidosGP14, 
         por_ausentesGP14 = (ausentesGP14/electoresGP14)*100)
```

Votos blancos + nulos

```{r}
blancos_nulos = dataGP14 %>% filter(TXORGPOL == "VOTOS EN BLANCO" | TXORGPOL =="VOTOS NULOS" ) %>%
                group_by(TXUBIGEO) %>% 
                summarise(blancosnulosGP14 = sum(VOTOS, na.rm = T)) 

data_finalGP14 = left_join(data_finalGP14, blancos_nulos, by="TXUBIGEO") #join

data_finalGP14  = data_finalGP14 %>% 
          mutate (por_blancosnulosGP14 = (blancosnulosGP14/emitidosGP14)*100) 
```

votos validos:

```{r}
data_finalGP14  = data_finalGP14 %>% 
          mutate (validosGP14 = emitidosGP14-blancosnulosGP14) 
```

OJO: todavia no tengo la información de tipo de organizacion politica. 

Concentración:

```{r}
dataGP14= dataGP14[!dataGP14$TXORGPOL == "VOTOS EN BLANCO",]
dataGP14= dataGP14[!dataGP14$TXORGPOL == "VOTOS NULOS",]
```

Ordenar tabla en según votos

```{r}
dataGP14 = dataGP14[order(dataGP14$TXUBIGEO, -dataGP14$VOTOS),] 
```

Votos ganador
```{r}
primero = dataGP14 %>% group_by(TXUBIGEO) %>% filter(row_number()==1) %>% mutate(primeroGP14=VOTOS)

data_finalGP14 = left_join(data_finalGP14, primero[c(1,12)], by="TXUBIGEO") #join 
```

Votos segundo
```{r}
segundo = dataGP14 %>% group_by(TXUBIGEO) %>% filter(row_number()==2) %>% mutate(segundoGP14=VOTOS)

data_finalGP14 = left_join(data_finalGP14, segundo[c(1,12)], by="TXUBIGEO") #join 
```

Calculo concentración:

```{r}
data_finalGP14 = data_finalGP14 %>% mutate(concentracionGP14 = primeroGP14/validosGP14 + segundoGP14/validosGP14)
```

```{r}
head(data_finalGP14)
```


##### GOBIERNO DISTRITAL 2014

Carga data: 

```{r}
dataGL14=read_xlsx("distrital_2014_DISTRITAL.xlsx")
head(dataGL14)
```

###ORDENAR DATA:

Electores por distritos:

```{r}
electores = dataGL14 %>% 
            group_by(TXUBIGEO) %>% #seleccionar una fila por distrito
           summarise(electoresGL14 = max(ELECTORES, na.rm = T)) 
```

Votos emitidos por distritos:

```{r}
emitidos = dataGL14 %>% group_by(TXUBIGEO) %>% 
           summarise(emitidosGL14 = sum(VOTOS, na.rm = T))

data_finalGL14 = left_join(electores, emitidos, by="TXUBIGEO") #join

#ciudar que los que tienen 0 en votos emitidos sean NA
data_finalGL14[data_finalGL14$emitidosGL14==0,]$emitidosGL14 = NA
```

Calcular ausentes: 

```{r}
data_finalGL14 = data_finalGL14 %>% 
  mutate(ausentesGL14= electoresGL14 - emitidosGL14, 
         por_ausentesGL14 = (ausentesGL14/electoresGL14)*100)
```

Votos blancos + nulos

```{r}
blancos_nulos = dataGL14 %>% filter(TXORGPOL == "VOTOS EN BLANCO" | TXORGPOL =="VOTOS NULOS" ) %>%
                group_by(TXUBIGEO) %>% 
                summarise(blancosnulosGL14 = sum(VOTOS, na.rm = T)) 

data_finalGL14 = left_join(data_finalGL14, blancos_nulos, by="TXUBIGEO") #join

data_finalGL14  = data_finalGL14 %>% 
          mutate (por_blancosnulosGL14 = (blancosnulosGL14/emitidosGL14)*100) 
```

votos validos:

```{r}
data_finalGL14  = data_finalGL14 %>% 
          mutate (validosGL14 = emitidosGL14-blancosnulosGL14) 
```

OJO: todavia no tengo la información de tipo de organizacion politica. 

Concentración:

```{r}
dataGL14= dataGL14[!dataGL14$TXORGPOL == "VOTOS EN BLANCO",]
dataGL14= dataGL14[!dataGL14$TXORGPOL == "VOTOS NULOS",]
```

Ordenar tabla en según votos

```{r}
dataGL14 = dataGL14[order(dataGL14$TXUBIGEO, -dataGL14$VOTOS),] 
```

Votos ganador
```{r}
primero = dataGL14 %>% group_by(TXUBIGEO) %>% filter(row_number()==1) %>% mutate(primeroGL14=VOTOS)

data_finalGL14 = left_join(data_finalGL14, primero[c(1,12)], by="TXUBIGEO") #join 
```

Votos segundo
```{r}
segundo = dataGL14 %>% group_by(TXUBIGEO) %>% filter(row_number()==2) %>% mutate(segundoGL14=VOTOS)

data_finalGL14 = left_join(data_finalGL14, segundo[c(1,12)], by="TXUBIGEO") #join 
```

Calculo concentración:

```{r}
data_finalGL14 = data_finalGL14 %>% mutate(concentracionGL14 = primeroGL14/validosGL14 + segundoGL14/validosGL14)
```

```{r}
head(data_finalGL14)
```