
##### GOBIERNO PROVINCIAL 2010

Carga data: 

```{r}
dataGP14=read_xlsx("Tabla6-ERM2010-Provincial.xlsx")
head(dataGP14)
```

###ORGANIZACIONES POLITICAS:

Organizaciones

```{r}
names(table(dataGP14$TIPOORGPOL))
```

Recategorizar:

```{r}
orgP = names(table(dataGP14$TIPOORGPOL))[3]  
orgD =names(table(dataGP14$TIPOORGPOL))[4] 
partido = names(table(dataGP14$TIPOORGPOL))[5]  

dataGP14$TIPOORGPOL2 = dataGP14$TIPOORGPOL #creo copia

dataGP14$TIPOORGPOL2[dataGP14$TIPOORGPOL2 == orgP] = "ORGANIZACION LOCAL"
dataGP14$TIPOORGPOL2[dataGP14$TIPOORGPOL2 == orgD] = "ORGANIZACION LOCAL"
dataGP14$TIPOORGPOL2[dataGP14$TIPOORGPOL2 == partido] = "PARTIDO POLITICO"
```

```{r}
names(table(dataGP14$TIPOORGPOL2))
```

```{r}
organizacionesGP14 = dataGP14[c(9,18)]
organizacionesGP14 = organizacionesGP14[!duplicated(organizacionesGP14),]
```

Total organizaciones a nivel regional:

```{r}
nrow(organizacionesGP14)
```

Por tipo:

```{r}
table(organizacionesGP14$TIPOORGPOL2)
```

Partidos:

```{r}
names(table(organizaciones14[organizaciones14$TIPOORGPOL=="PARTIDO POLITICO",]$TXORGPOL))
```

###ORDENAR DATA:

Electores por distritos:

```{r}
electores2 = dataGP14 %>% 
            group_by(UBIGEO) %>% #seleccionar una fila por distrito
           summarise(electoresGP14 = max(NUMELECTORES, na.rm = T)) 
```

Votos emitidos por distritos:

```{r}
emitidos2 = dataGP14 %>% group_by(UBIGEO) %>% 
           summarise(emitidosGP14 = max(NUM_VOTOS_EMITIDOS, na.rm = T)) 

data_finalGP14 = left_join(electores2, emitidos2, by="UBIGEO") #join
```

Calcular ausentes: 

```{r}
data_finalGP14 = data_finalGP14 %>% 
  mutate(ausentesGP14= electoresGP14 - emitidosGP14, 
         por_ausentesGP14 = (ausentesGP14/electoresGP14)*100)
```

votos validos:

```{r}
validos = dataGP14 %>% 
            group_by(UBIGEO) %>% #seleccionar una fila por distrito
           summarise(validosGP14 = sum(NUM_VOTOS_ORGPOL, na.rm = T)) 

data_finalGP14 = left_join(data_finalGP14, validos, by="UBIGEO") #join

#Ojo, tengo casos con 0 votos validos.. estoy asumiento que esos son blancos y nulos
```

Votos blancos + nulos

```{r}
data_finalGP14 = data_finalGP14 %>% 
  mutate(blancosnulosGP14 = emitidosGP14 - validosGP14, 
         por_blancosnulosGP14 = (blancosnulosGP14/emitidosGP14)*100)
```

votos partidos politicos:

```{r}
partidos_politicos2 = dataGP14 %>% filter(TIPOORGPOL2 == "PARTIDO POLITICO") %>%
                group_by(UBIGEO) %>% 
                summarise(partidosGP14 = sum(NUM_VOTOS_ORGPOL, na.rm = T)) 

data_finalGP14 = left_join(data_finalGP14, partidos_politicos2, by="UBIGEO") #join
```

votos movimientos regionales:

```{r}
mov_regionales2 = dataGP14 %>% filter(TIPOORGPOL2 == "MOVIMIENTO REGIONAL") %>%
                group_by(UBIGEO) %>% 
                summarise(movimientosGP14 = sum(NUM_VOTOS_ORGPOL, na.rm = T)) 

data_finalGP14 = left_join(data_finalGP14, mov_regionales2, by="UBIGEO") #join
```

porcentaje partidos/movimientos

```{r}
data_finalGP14  = data_finalGP14 %>% 
          mutate (por_partidosGP14 = (partidosGP14/validosGP14)*100,
                  por_movimientosGP14 = (movimientosGP14/validosGP14)*100) 
```

Concentración:

Ordenar tabla según votos

```{r}
dataGP14 = dataGP14[order(dataGP14$UBIGEO, -dataGP14$NUM_VOTOS_ORGPOL),] 
```

Votos ganador
```{r}
primero2 = dataGP14 %>% group_by(UBIGEO) %>% filter(row_number()==1) %>% mutate(primeroGP14=NUM_VOTOS_ORGPOL)

data_finalGP14 = left_join(data_finalGP14, primero2[c(1,19)], by="UBIGEO") #join 
```

Votos segundo
```{r}
segundo2 = dataGP14 %>% group_by(UBIGEO) %>% filter(row_number()==2) %>% mutate(segundoGP14=NUM_VOTOS_ORGPOL)

data_finalGP14 = left_join(data_finalGP14, segundo2[c(1,19)], by="UBIGEO") #join 
```

Calculo concentración:

```{r}
data_finalGP14 = data_finalGP14 %>% mutate(concentracionGP14 = primeroGP14/validosGP14 + segundoGP14/validosGP14)
```

```{r}
head(data_finalGR14)
```
